\documentclass[12pt,a4paper]{article}
\usepackage[legalpaper, portrait, margin=2cm]{geometry}
\usepackage{fancyhdr}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{wrapfig}
\usepackage{blindtext}
\usepackage{hyperref}
\usepackage{tikz}
\usepackage{subcaption}
\usepackage{adjustbox}
\usepackage{siunitx}
\usepackage{booktabs}

\graphicspath{ {./} }
\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  filecolor=magenta,
  urlcolor=blue,
  citecolor=blue,
  pdftitle={Relatório Projeto IA 2021/2022},
  pdfpagemode=FullScreen,
}

\pagestyle{fancy}
\fancyhf{}
\rhead{Grupo \textbf{al003}}
\lhead{Relatório Projeto IA 2021/2022 LEIC-A}
\cfoot{Diogo Cardoso (99209) e Diogo Correia (99211)}

\definecolor{pastel-green}{HTML}{CBE896}
\definecolor{pastel-yellow}{HTML}{FEE440}

\renewcommand{\footrulewidth}{0.2pt}

\renewcommand{\labelitemii}{$\circ$}
\renewcommand{\labelitemiii}{$\diamond$}
\newcommand{\op}{\operatorname}

\begin{document}
\section{Descrição e Modelação do Problema}

Foi proposto o desenvolvimento de um programa em Python com o objetivo de resolver o
problema \textit{Takuzu} utilizando técnicas de procura de IA.
O presente relatório apresenta uma solução para o problema.

Este jogo lógico decorre sobre um tabuleiro com uma grelha quadrada onde cada célula
pode conter os números 0 ou 1.
O objetivo é, dado um tabuleiro com uma grelha \(N \times N\) preenchida parcialmente e
sem alterar o conteúdo destas posições, preencher totalmente a grelha com 0s e 1s de maneira
a que a diferença entre 0s e 1s em cada linha e coluna seja zero para Ns pares e um para Ns ímpares,
não haja mais do que dois números iguais em linha (tanto horizontal como verticalmente),
todas as linhas sejam diferentes entre si e todas as colunas sejam diferentes entre si.

A solução formaliza o \textit{Takuzu} como um problema de procura.
Cada \textbf{estado} do tabuleiro é representado por uma matriz \(N \times N\) sendo que o estado inicial
é a representação matricial do tabuleiro lido do \textit{standard input}.
Para efeitos práticos, as posições livres são representadas com o número 2.
Uma \textbf{ação} é representada pelo tuplo \texttt{(x, y, value)}, e consiste em colocar um 0 ou um 1 (\texttt{value})
numa posição livre do tabuleiro \texttt{(x, y)}. O \textbf{resultado} de uma dada ação consiste na
atribuição do valor \texttt{value} à posição \texttt{(x, y)} a uma cópia do estado do nó pai.

\section{Estratégia de Solução}

Ao modelar uma solução para o problema, rapidamente se verificou a importância de reduzir
o \textbf{fator de ramificação} da árvore de procura, diminuindo o custo de memória,
e evitando a criação de estados repetidos, o que desperdiça tempo de computação.

Logo, para cada estado apenas é considerada uma das posições livres, o que significa
que os sucessores desse estado são os que resultam da colocação de um valor nessa posição.
Adicionalmente, as ações consideradas para uma dada posição consistem apenas naquelas que
\textbf{não quebram nenhuma das regras} mencionadas no ponto anterior.
Por exemplo, as ações possíveis para o tabuleiro abaixo são, considerando todas as posições livres,
\texttt{(1, 0, 1)}, \texttt{(1, 3, 1)} e \texttt{(2, 3, 1)}.

\[
  \begin{array}{cccc}
    0 & 1 & 1 & 0 \\
    2 & 0 & 0 & 2 \\
    0 & 0 & 1 & 2 \\
    1 & 1 & 0 & 0
  \end{array}
\]

Posto isto, é fácil observar que ainda pode ser feita uma \textbf{otimização} à escolha da
posição sobre a qual se vai efetuar uma ação num dado estado -
\textbf{posições com apenas uma ação possível são escolhidas primeiro} -
o que leva a um fator de ramificação entre 1 e 2,
mais próximo do 1, um \textit{pruning} bastante bom.

Dado nenhuma ação quebrar as regras, o \textbf{teste objetivo} consiste apenas em determinar
se o tabuleiro se encontra totalmente preenchido. Caso isto aconteça, sabemos que
nos encontramos perante uma solução válida. Isto permite uma verificação de tempo constante, \(O(1)\).

Atendendo ao problema, uma abordagem simples para a verificação da qualidade de
um estado é contar o número de posições livres com dois valores possíveis
(o número de escolhas que terão que ser feitas).
Temos portanto que um estado A é melhor que um estado B quando
\(\text{posicoes\_livres\_2valor\_A} < \text{posicoes\_livres\_2valor\_B}\).
Considerando \(C_{\op{empty}}\) como o conjunto de posições vazias, a
\textbf{função heurística} utilizada foi, para os algoritmos de procura informada, então

\[
  \begin{aligned}
    \op{cell}(x, y) = \begin{cases}
                        1      & \text{if}~\#\op{possible\_values}(x, y) = 2 \\
                        0      & \text{if}~\#\op{possible\_values}(x, y) = 1 \\
                        \infty & \text{if}~\#\op{possible\_values}(x, y) = 0
                      \end{cases}
     & , &
    h(\op{state}) = \sum_{x,y\in C_{\op{empty}}} \op{cell}_{\op{state}}(x, y)
  \end{aligned}
\]

Além da heurística, foi implementada uma função de desempate mais complexa através de
modificações ao método \texttt{\_\_lt\_\_(self, other)} da classe \texttt{TakuzuState}, como sugerido no enunciado.
Considerou-se que os estados que se encontram mais abaixo na árvore, isto é, aqueles com
menos espaços por preencher, devem ter prioridade face aos mais acima.

\section{Avaliação Experimental}

Para testar os vários algoritmos de procura, geraram-se vários tabuleiros que satisfaziam a restição do enunciado, isto é,
que só têm uma solução possível. Ao contrário dos tabuleiros fornecidos pelo corpo docente, estes tabuleiros são muito
esparsos, pelo que vão haver muitas possibilidades para cada célula, aumentando o fator de ramificação
(ficará mais próximo de 2).

Os critérios utilizados para comparar os algoritmos de procura foram o \textbf{tempo de execução},
os \textbf{nós gerados} e os \textbf{nós expandidos}.
Para a medição do tempo de execução, foi utilizada a ferramenta \href{https://github.com/sharkdp/hyperfine}{\textit{hyperfine}}.
Os resultados podem ser observados na tabela e figuras seguintes.

\begin{adjustbox}{width={\textwidth}, totalheight={\textheight}, keepaspectratio}
  \begin{tabular}{ll cccc cccc cccc}
    \toprule
    \multicolumn{2}{l}{Input} & \multicolumn{4}{c}{Tempo de Execução (s)} & \multicolumn{4}{c}{Nós Gerados} & \multicolumn{4}{c}{Nós Expandidos}                                                                                   \\
    \cmidrule(lr){1-2} \cmidrule(lr){3-6} \cmidrule(lr){7-10} \cmidrule(lr){11-14}
    N                         & d                                         & GS                              & DFS                                & A*     & BFS    & GS    & DFS   & A*    & BFS   & GS    & DFS   & A*    & BFS   \\
    \midrule
    % size04_09.in
    4                         & 11                                        & 0.1126                          & 0.1167                             & 0.1129 & 0.1191 & 11    & 11    & 11    & 11    & 11    & 11    & 11    & 11    \\
    % size04_22.in
    4                         & 12                                        & 0.1170                          & 0.1191                             & 0.1200 & 0.1237 & 12    & 12    & 12    & 12    & 12    & 12    & 12    & 12    \\
    % size06_18.in
    6                         & 27                                        & 0.1170                          & 0.1175                             & 0.1184 & 0.1159 & 27    & 27    & 27    & 27    & 27    & 27    & 27    & 27    \\
    % size06_38.in
    6                         & 30                                        & 0.1166                          & 0.1212                             & 0.1161 & 0.1273 & 33    & 35    & 33    & 35    & 31    & 35    & 31    & 35    \\
    % size08_49.in
    8                         & 49                                        & 0.1248                          & 0.1301                             & 0.1374 & 0.1309 & 112   & 115   & 132   & 137   & 99    & 112   & 117   & 137   \\
    % size08_18.in
    8                         & 53                                        & 0.1226                          & 0.1719                             & 0.1298 & 0.1936 & 69    & 601   & 87    & 740   & 58    & 597   & 75    & 740   \\
    % size10_34.in
    10                        & 78                                        & 0.1308                          & 0.1708                             & 0.1390 & 0.1832 & 112   & 426   & 117   & 450   & 96    & 420   & 101   & 450   \\
    % size10_42.in
    10                        & 81                                        & 0.1299                          & 1.965                              & 0.1505 & 2.604  & 103   & 14531 & 135   & 17244 & 88    & 14525 & 117   & 17244 \\
    % size12_04.in
    12                        & 114                                       & 1.290                           & 1.572                              & 1.817  & 2.004  & 4364  & 9582  & 5718  & 11590 & 3786  & 9572  & 4955  & 11590 \\
    % size12_02.in
    12                        & 116                                       & 12.355                          & 6.506                              & 20.706 & 10.178 & 21403 & 51572 & 28066 & 63173 & 18607 & 51563 & 24355 & 63173 \\
    % t13.in
    31                        & 180                                       & 0.1932                          & 0.1914                             & 0.1939 & 0.1836 & 180   & 180   & 180   & 180   & 180   & 180   & 180   & 180   \\
    \bottomrule
  \end{tabular}
\end{adjustbox} \\

% TODO Gráficos pipis

\subsection{Análise de Resultados}

% TODO

\section{Conclusões}

As quatro procuras são \textbf{completas}, dado que em cada ação se preenche uma posição do tabuleiro,
o que impede a entrada em loops.
Adicionalmente, a \textbf{otimalidade}, que corresponde a descobrir a solução de menor custo,
não é relevante para este problema pois todas as soluções possíveis se encontram à mesma profundidade.
Além disso, estamos a considerar apenas tabuleiros com uma única solução,
pelo que a solução, quando encontrada, será sempre a mesma.
O custo ótimo do problema (\(C*\)) é sempre igual ao número inicial de posições livres.
Isto significa que a escolha da procura apenas influencia a rapidez com que se resolve o problema.
É importante fazer notar que a diferença entre as procuras cegas e as informadas
apenas é percetível quando a posição livre escolhida para efetuar uma ação tem duas ações possíveis.
Nos casos em que apenas há uma ação possível o comportamento é idêntico para ambas, como é de esperar.
Considerando a admissibilidade e consistência da heurística, é observável que
% TODO FIXME below
\colorbox{red}{cenas, não me apetece pensar se esta porcaria é admissível}.
Concluindo, com base na análise efetuada, foi escolhida a \textbf{procura gananciosa}, já que
% TODO FIXME below
\colorbox{red}{cenas}

\end{document}